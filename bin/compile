#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>


indent() {
  sed -u 's/^/       /'
}

#echo "-----> Found a hello.txt"

# if hello.txt is empty, abort the build
#if [ ! -s $1/hello.txt ]; then
#  echo "hello.txt was empty" | indent
#  exit 1
#fi

# replace hello with goodbye in a new file
#cat $1/hello.txt | sed -e "s/[Hh]ello/Goodbye/g" > $1/goodbye.txt

#
#
#


    echo "Zapp360-Sigma compilation started!" | indent
    echo "Zapp360-Sigma compilation started!" | indent
    echo "Zapp360-Sigma compilation started!" | indent
    echo "Zapp360-Sigma compilation started!" | indent
    echo "Zapp360-Sigma compilation started!" | indent

echo "BUILD_DIR - $BUILD_DIR"
echo "CACHE_DIR - $CACHE_DIR"
echo "ENV_DIR - $ENV_DIR"

    echo "Zapp360-Sigma compilation started!" | indent
    echo "Zapp360-Sigma compilation started!" | indent
    echo "Zapp360-Sigma compilation started!" | indent
    echo "Zapp360-Sigma compilation started!" | indent
    echo "Zapp360-Sigma compilation started!" | indent

npm install -g bower grunt-cli grunt gulp
npm install bower grunt-cli grunt gulp
#sudo npm install -g bower grunt-cli gulp
#sudo npm install -g generator-angular
#npm install
#bower install

#sudo gem update --system
#sudo gem install compass
#sudo npm install -g grunt-contrib-compass
gem update --system
##gem install sass
##gem install -n /app/vendor/ruby-2.3.0/bin/gem compass
##gem install compass

# install compass
echo "Installing Compass"
export GEM_HOME=$1/.gem/ruby/2.3.0
PATH="$GEM_HOME/bin:$PATH"
HOME=$1 gem install compass --user-install --no-rdoc --no-ri


echo "Building runtime environment"
mkdir -p $1/.profile.d
echo "export PATH=\"\$HOME/vendor/node/bin:\$HOME/bin:\$HOME/node_modules/.bin:\$PATH\";" > $1/.profile.d/nodejs.sh
echo "export PATH=\"\$HOME/.gem/ruby/2.3.0/bin:\$PATH\"" > $1/.profile.d/ruby.sh

npm install -g grunt-contrib-compass
##grunt build
##grunt install
npm install --save gifsicle
npm install grunt-contrib-imagemin

npm install
bower install
#grunt build


echo "Debug point here"
echo "Debug point here"
echo "Debug point here"
echo "Debug point here"


##apt-get install ruby-compass

##PATH=/app/vendor/ruby-2.3.0/bin/gem:$PATH
##echo "PATH=\$PATH:/var/lib/gems/2.3/bin:\$HOME/.gem/ruby/2.3/bin" >> /etc/profile.d/rubygems2.3.sh
ruby -v
compass -v

echo "Debug point here"
echo "Debug point here"
echo "Debug point here"
echo "Debug point here"

node -v

echo "Debug point here"
echo "Debug point here"
echo "Debug point here"
echo "Debug point here"

#
#
#


sh $1/build-buildpack.sh
